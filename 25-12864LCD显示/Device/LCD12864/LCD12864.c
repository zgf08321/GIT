#include "LCD12864.h"
#include "ST5767.h"
#include "string.h"
#include "stdio.h"

//#include "GT20L16S1Y.h"

#define swap(a, b) { uint8_t t = a; a = b; b = t; }

#define BLACK 1
#define WHITE 0

#define LCDWIDTH 128
#define LCDHEIGHT 64

#define CMD_DISPLAY_OFF   0xAE
#define CMD_DISPLAY_ON    0xAF

#define CMD_SET_DISP_START_LINE  0x40
#define CMD_SET_PAGE  0xB0

#define CMD_SET_COLUMN_UPPER  0x10
#define CMD_SET_COLUMN_LOWER  0x00

#define CMD_SET_ADC_NORMAL  0xA0
#define CMD_SET_ADC_REVERSE 0xA1

#define CMD_SET_DISP_NORMAL 0xA6
#define CMD_SET_DISP_REVERSE 0xA7

#define CMD_SET_ALLPTS_NORMAL 0xA4
#define CMD_SET_ALLPTS_ON  0xA5
#define CMD_SET_BIAS_9 0xA2 
#define CMD_SET_BIAS_7 0xA3

#define CMD_RMW  0xE0
#define CMD_RMW_CLEAR 0xEE
#define CMD_INTERNAL_RESET  0xE2
#define CMD_SET_COM_NORMAL  0xC0
#define CMD_SET_COM_REVERSE  0xC8
#define CMD_SET_POWER_CONTROL  0x28
#define CMD_SET_RESISTOR_RATIO  0x20
#define CMD_SET_VOLUME_FIRST  0x81
#define CMD_SET_VOLUME_SECOND  0
#define CMD_SET_STATIC_OFF  0xAC
#define CMD_SET_STATIC_ON  0xAD
#define CMD_SET_STATIC_REG  0x0
#define CMD_SET_BOOSTER_FIRST  0xF8
#define CMD_SET_BOOSTER_234  0
#define CMD_SET_BOOSTER_5  1
#define CMD_SET_BOOSTER_6  3
#define CMD_NOP   0xE3
#define CMD_TEST  0xF0

#define ST7565_STARTBYTES 1

#define enablePartialUpdate

//sbit LCD_SCLK =P2^4;
//sbit LCD_CS   =P2^0;
//sbit LCD_DC   =P2^2;
//sbit LCD_SI   =P2^3;
//sbit LCD_RST  =P2^1;



unsigned char pagemap[] = { 7, 6, 5, 4 ,3, 2, 1, 0};

//struct NumbCharType                 
//{
//	unsigned char  Index[1];           
//	unsigned char  Msk[16];           
//};

struct NumbCharType Numb_Char[]=
{
/*--  ??:  0  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'0',0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,
/*--  ??:  1  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'1',0x00,0x00,0x00,0x00,0xF8,0x10,0x10,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,
/*--  ??:  2  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'2',0x00,0x70,0x88,0x08,0x08,0x08,0x70,0x00,0x00,0x30,0x21,0x22,0x24,0x28,0x30,0x00,
/*--  ??:  3  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'3',0x00,0x30,0x48,0x88,0x88,0x08,0x30,0x00,0x00,0x0E,0x11,0x20,0x20,0x20,0x18,0x00,
/*--  ??:  4  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'4',0x00,0x00,0xF8,0x10,0x20,0xC0,0x00,0x00,0x00,0x24,0x3F,0x24,0x24,0x04,0x07,0x00,
/*--  ??:  5  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'5',0x00,0x08,0x08,0x88,0x88,0x08,0xF8,0x00,0x00,0x0E,0x11,0x20,0x20,0x21,0x19,0x00,
/*--  ??:  6  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'6',0x00,0x00,0x18,0x88,0x88,0x10,0xE0,0x00,0x00,0x0E,0x11,0x20,0x20,0x11,0x0F,0x00,
/*--  ??:  7  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'7',0x00,0x08,0x38,0xC8,0x08,0x08,0x38,0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,
/*--  ??:  8  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'8',0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,
/*--  ??:  9  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'9',0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x11,0x22,0x22,0x31,0x00,0x00,
/*--  ??:  .  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'.',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,
/*--  ??:  :  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
':',0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,

};

struct NumbCharType ASCII_Char[]=
{
/*--  ??:  a  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'a',0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x22,0x22,0x22,0x24,0x19,0x00,
/*--  ??:  b  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'b',0x00,0x00,0x00,0x80,0x80,0x00,0xF8,0x08,0x00,0x0E,0x11,0x20,0x20,0x11,0x3F,0x00,
/*--  ??:  c  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'c',0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x11,0x20,0x20,0x20,0x11,0x0E,0x00,
/*--  ??:  d  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'd',0x00,0xF8,0x88,0x80,0x80,0x00,0x00,0x00,0x20,0x3F,0x10,0x20,0x20,0x11,0x0E,0x00,
/*--  ??:  e  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'e',0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x13,0x22,0x22,0x22,0x22,0x1F,0x00,
/*--  ??:  f  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'f',0x18,0x88,0x88,0x88,0xF0,0x80,0x80,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,
/*--  ??:  g  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'g',0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x60,0x93,0x94,0x94,0x94,0x6B,0x00,
/*--  ??:  h  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'h',0x00,0x00,0x80,0x80,0x80,0x00,0xF8,0x08,0x20,0x3F,0x20,0x00,0x00,0x21,0x3F,0x20,
/*--  ??:  i  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'i',0x00,0x00,0x00,0x00,0x98,0x98,0x80,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,
/*--  ??:  j  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'j',0x00,0x00,0x98,0x98,0x80,0x00,0x00,0x00,0x00,0x00,0x7F,0x80,0x80,0x80,0xC0,0x00,
/*--  ??:  k  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'k',0x00,0x80,0x80,0x80,0x00,0x00,0xF8,0x08,0x00,0x20,0x30,0x2D,0x02,0x24,0x3F,0x20,
/*--  ??:  l  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'l',0x00,0x00,0x00,0x00,0xF8,0x08,0x08,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,
/*--  ??:  m  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'm',0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x3F,0x00,0x20,0x3F,0x00,0x20,0x3F,0x20,
/*--  ??:  n  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'n',0x00,0x00,0x80,0x80,0x80,0x00,0x80,0x80,0x20,0x3F,0x20,0x00,0x00,0x21,0x3F,0x20,
/*--  ??:  o  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'o',0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,
/*--  ??:  p  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'p',0x00,0x00,0x00,0x80,0x80,0x00,0x80,0x80,0x00,0x0E,0x11,0x20,0x20,0xA1,0xFF,0x80,
/*--  ??:  q  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'q',0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x80,0xFF,0xA0,0x20,0x20,0x11,0x0E,0x00,
/*--  ??:  r  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'r',0x00,0x80,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x01,0x00,0x20,0x21,0x3F,0x20,0x20,
/*--  ??:  s  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
's',0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x19,0x24,0x24,0x24,0x24,0x33,0x00,
/*--  ??:  t  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
't',0x00,0x00,0x80,0x80,0xE0,0x80,0x80,0x00,0x00,0x00,0x20,0x20,0x1F,0x00,0x00,0x00,
/*--  ??:  u  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'u',0x00,0x80,0x80,0x00,0x00,0x00,0x80,0x80,0x20,0x3F,0x10,0x20,0x20,0x20,0x1F,0x00,
/*--  ??:  v  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'v',0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x00,0x01,0x06,0x08,0x30,0x0E,0x01,0x00,
/*--  ??:  w  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'w',0x80,0x80,0x80,0x00,0x80,0x00,0x80,0x80,0x00,0x0F,0x30,0x0C,0x03,0x0C,0x30,0x0F,
/*--  ??:  x  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'x',0x00,0x80,0x80,0x80,0x00,0x80,0x80,0x00,0x00,0x20,0x31,0x0E,0x2E,0x31,0x20,0x00,
/*--  ??:  y  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'y',0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x00,0x01,0x06,0x18,0x70,0x8E,0x81,0x80,
/*--  ??:  z  --*/
/*--  ??12;  ??????????:?x?=8x16   --*/
'z',0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x30,0x21,0x22,0x2C,0x30,0x21,0x00,

};
//
//unsigned char code st7565_buffer[1024] = { 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x3, 0x7, 0xF, 0x1F, 0x1F, 0x3F, 0x3F, 0x3F, 0x3F, 0x7, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x7F, 0x3F, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x1F, 0x3F, 0x70, 0x70, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x6, 0x6, 0x0, 0x0, 0x0, 0x3, 0x3, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//
//0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0xF, 0x7, 0x7, 
//0x7, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x3E, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xF, 0x3F, 
//0x70, 0x60, 0x60, 0x60, 0x60, 0x30, 0x7F, 0x3F, 0x0, 0x0, 0x1F, 0x3F, 0x70, 0x60, 0x60, 0x60, 
//0x60, 0x39, 0xFF, 0xFF, 0x0, 0x6, 0x1F, 0x39, 0x60, 0x60, 0x60, 0x60, 0x30, 0x3F, 0x7F, 0x0, 
//0x0, 0x60, 0xFF, 0xFF, 0x60, 0x60, 0x0, 0x7F, 0x7F, 0x70, 0x60, 0x60, 0x40, 0x0, 0x7F, 0x7F, 
//0x0, 0x0, 0x0, 0x0, 0x7F, 0x7F, 0x0, 0x0, 0x0, 0x7F, 0x7F, 0x0, 0x0, 0x60, 0xFF, 0xFF, 
//0x60, 0x60, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//
//0x80, 0xF8, 0xFC, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xEF, 0xE7, 0xE7, 0xE3, 
//0xF3, 0xF9, 0xFF, 0xFF, 0xFF, 0xF7, 0x7, 0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0xFF, 
//0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x3F, 0x3F, 0x1F, 0xF, 0x7, 0x3, 0x0, 0x0, 0x0, 0xC0, 
//0xE0, 0x60, 0x20, 0x20, 0x60, 0xE0, 0xE0, 0xE0, 0x0, 0x0, 0x80, 0xC0, 0xE0, 0x60, 0x20, 0x60, 
//0x60, 0xE0, 0xE0, 0xE0, 0x0, 0x0, 0x80, 0xC0, 0x60, 0x60, 0x20, 0x60, 0x60, 0xE0, 0xE0, 0x0, 
//0x0, 0x0, 0xE0, 0xE0, 0x0, 0x0, 0x0, 0xE0, 0xE0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0xE0, 
//0x60, 0x60, 0x60, 0x60, 0xE0, 0x80, 0x0, 0x0, 0x0, 0xE0, 0xE0, 0x0, 0x0, 0x0, 0xE0, 0xE0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//
//0x0, 0x0, 0x0, 0x3, 0x7, 0x1F, 0x9F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFD, 0xF1, 0xE3, 
//0xE3, 0xCF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0xFC, 0x7F, 0x3F, 0x3F, 0x3F, 0x3F, 0x7F, 0xFF, 0xFF, 
//0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFC, 0xF0, 0xE0, 0x80, 0x0, 0x0, 0x0, 0xC, 
//0x1C, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x7F, 0x7F, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x7, 0x7, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1C, 0xC, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//
//0x0, 0x7, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFE, 0xFE, 0xFE, 0xFC, 0xF8, 
//0xF8, 0xF0, 0xFE, 0xFF, 0xFF, 0xFF, 0x7F, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x1F, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xFF, 
//0xFF, 0x0, 0x0, 0x0, 0xFF, 0xFF, 0xE0, 0xC0, 0xC0, 0xC0, 0xFF, 0x7F, 0x0, 0x0, 0x1E, 0x7F, 
//0xE1, 0xC0, 0xC0, 0xC0, 0xC0, 0x61, 0xFF, 0xFF, 0x0, 0x0, 0xFE, 0xFF, 0x1, 0x0, 0x0, 0x0, 
//0xFF, 0xFF, 0x0, 0x0, 0x21, 0xF9, 0xF8, 0xDC, 0xCC, 0xCF, 0x7, 0x0, 0xC0, 0xFF, 0xFF, 0xC0, 
//0x80, 0x0, 0xFF, 0xFF, 0xC0, 0xC0, 0x80, 0x0, 0x0, 0xFF, 0xFF, 0x0, 0x0, 0x1F, 0x7F, 0xF9, 
//0xC8, 0xC8, 0xC8, 0xC8, 0x79, 0x39, 0x0, 0x0, 0x71, 0xF9, 0xD8, 0xCC, 0xCE, 0x47, 0x3, 0x0, 
//
//0x0, 0x0, 0x0, 0x0, 0x80, 0x80, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
//0x0, 0x0, 0x0, 0x80, 0xC0, 0xE0, 0xF0, 0xF8, 0xF8, 0xFC, 0xFC, 0xFC, 0xFC, 0xF8, 0xF0, 0xC0, 
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xC0, 
//0xC0, 0x0, 0x0, 0x0, 0xC0, 0xC0, 0x0, 0x0, 0x0, 0x0, 0xC0, 0xC0, 0x0, 0x0, 0x0, 0x80, 
//0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0xC0, 0xC0, 0x0, 0x0, 0x0, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 
//0xC0, 0x80, 0x0, 0x0, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x0, 0x0, 0x0, 0xC0, 0xC0, 0x0, 
//0x0, 0x0, 0xC0, 0x80, 0x0, 0x0, 0x0, 0x0, 0x0, 0xC0, 0xC0, 0x0, 0x0, 0x0, 0x80, 0xC0, 
//0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x80, 0x0, 0x0, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x0, 0x0, 
//
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
//0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,};



//????1ms
void _delay_ms(unsigned int c)
{
	unsigned int a,b;
	for(; c>0; c--)
		for(a=4; a>0; a--)
			for(b=410; b>0; b--); 	
}




/*========????????==============*/
void write_command(unsigned char cmd)
{ 
	unsigned char i;
	LCD_DC(0);

	LCD_SCLK(0);
	LCD_CS(0);
	for(i=0;i<8;i++)
	{
		LCD_SCLK(0);
		LCD_SI(cmd&0x80);
		cmd = cmd<<1;
		LCD_SCLK(1);
	}
	LCD_CS(1); 						
}
/*========????????==============*/
void write_data(unsigned char dat)
{
	unsigned char i;
	LCD_DC(1);

	LCD_SCLK(0);
	LCD_CS(0);
	for(i=0;i<8;i++)
	{
		LCD_SCLK(0);
		LCD_SI(dat&0x80);
		dat = dat<<1;
		LCD_SCLK(1);
	}
	LCD_CS(1);
}

void LCD12864_command(unsigned char c)
{
  write_command(c);
}

void LCD12864_data(unsigned char c) 
{
  write_data(c);
}


#ifdef enablePartialUpdate
static unsigned char xUpdateMin, xUpdateMax, yUpdateMin, yUpdateMax;
#endif

static void updateBoundingBox(unsigned char xmin, unsigned char ymin, unsigned char xmax, unsigned char ymax) 
{
#ifdef enablePartialUpdate
  if (xmin < xUpdateMin) xUpdateMin = xmin;
  if (xmax > xUpdateMax) xUpdateMax = xmax;
  if (ymin < yUpdateMin) yUpdateMin = ymin;
  if (ymax > yUpdateMax) yUpdateMax = ymax;
#endif
}

void InitLCD12864_IO(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
	
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_5|GPIO_Pin_6|GPIO_Pin_7;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;
	
	/*´ò¿ªLEDÊ¹ÓÃµÄGPIOµÄÊ±ÖÓÊ¹ÄÜ*/
//	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);
//	GPIO_Init(GPIOA, &GPIO_InitStructure);	 //³õÊ¼»¯
	
	/*´ò¿ªLEDÊ¹ÓÃµÄGPIOµÄÊ±ÖÓÊ¹ÄÜ*/
	
//	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_3|GPIO_Pin_4|GPIO_Pin_5|GPIO_Pin_6|GPIO_Pin_7; //|DATA_PORT
	GPIO_Init(GPIOB, &GPIO_InitStructure);	 //³õÊ¼»¯
}

void LCD12864_init()
{
	InitLCD12864_IO();
	
	
	LCD_CS(0);

	LCD_RST(0);

	_delay_ms(500);	 //500ms

	LCD_RST(1);
	// LCD bias select
	LCD12864_command(CMD_SET_BIAS_7);	  //while(1);
	// ADC select
	LCD12864_command(CMD_SET_ADC_NORMAL);
	// SHL select
	LCD12864_command(CMD_SET_COM_NORMAL);
	// Initial display line
	LCD12864_command(CMD_SET_DISP_START_LINE);
	LCD12864_command(CMD_SET_PAGE);
	
	LCD12864_command(CMD_SET_COLUMN_LOWER);
	LCD12864_command(CMD_SET_COLUMN_UPPER);
	
	
	
	// turn on voltage converter (VC=1, VR=0, VF=0)
	LCD12864_command(CMD_SET_POWER_CONTROL | 0x4);
	// wait for 50% rising
	_delay_ms(50);
	
	// turn on voltage regulator (VC=1, VR=1, VF=0)
	LCD12864_command(CMD_SET_POWER_CONTROL | 0x6);
	// wait >=50ms
	_delay_ms(100);
	
	// turn on voltage follower (VC=1, VR=1, VF=1)
	LCD12864_command(CMD_SET_POWER_CONTROL | 0x7);
	// wait
	_delay_ms(10);
	
	// set lcd operating voltage (regulator resistor, ref voltage resistor)
	LCD12864_command(CMD_SET_RESISTOR_RATIO | 0x5);
	
	// initial display line
	// set page address
	// set column address
	// write display data
	
	// set up a bounding box for screen updates
	
	updateBoundingBox(0, 0, LCDWIDTH-1, LCDHEIGHT-1);
}

void st7565_set_brightness(unsigned char val) {
	
    LCD12864_command(CMD_SET_VOLUME_FIRST);
    LCD12864_command(CMD_SET_VOLUME_SECOND | (val & 0x3f));
}

void begin(unsigned char contrast) {
  LCD12864_init();
  LCD12864_command(CMD_DISPLAY_ON);
  LCD12864_command(CMD_SET_ALLPTS_NORMAL);
  st7565_set_brightness(contrast);
}

//void Display_LCD12864(void) 
//{
//  unsigned char col, maxcol, p;
//
//  for(p = 0; p < 8; p++) {
//    /*
//      putstring("new page! ");
//      uart_putw_dec(p);
//      putstring_nl("");
//    */
//	
//#ifdef enablePartialUpdate
//    // check if this page is part of update
//    if ( yUpdateMin >= ((p+1)*8) ) {
//      continue;   // nope, skip it!
//    }
//    if (yUpdateMax < p*8) {
//      break;
//    }
//#endif
//
//    st7565_command(CMD_SET_PAGE | pagemap[p]);
//
//
//#ifdef enablePartialUpdate
//    col = xUpdateMin;
//    maxcol = xUpdateMax;
//#else
//    // start at the beginning of the row
//    col = 0;
//    maxcol = LCDWIDTH-1;
//#endif
//
//    st7565_command(CMD_SET_COLUMN_LOWER | ((col+ST7565_STARTBYTES) & 0xf));
//    st7565_command(CMD_SET_COLUMN_UPPER | (((col+ST7565_STARTBYTES) >> 4) & 0x0F));
//    st7565_command(CMD_RMW);
//    
//    for(; col <= maxcol; col++) {
//      //uart_putw_dec(col);
//      //uart_putchar(' ');
//      st7565_data(st7565_buffer[(128*p)+col]);
//    }
//  }
//#ifdef enablePartialUpdate
//  xUpdateMin = LCDWIDTH - 1;
//  xUpdateMax = 0;
//  yUpdateMin = LCDHEIGHT-1;
//  yUpdateMax = 0;
//#endif
//}
//
//
//void clear(void) {
//  memset(st7565_buffer, 0, 1024);
//  updateBoundingBox(0, 0, LCDWIDTH-1, LCDHEIGHT-1);
//}



//void setpixel(unsigned char x, unsigned char y, unsigned char color) {
//  if ((x >= LCDWIDTH) || (y >= LCDHEIGHT))
//    return;
//
//  // x is which column
//  if (color) 
//    st7565_buffer[x+ (y/8)*128] |= _BV(7-(y%8));  
//  else
//    st7565_buffer[x+ (y/8)*128] &= ~_BV(7-(y%8)); 
//
//  updateBoundingBox(x,y,x,y);
//}

void Full_display(void) {
  unsigned char p, c;
  for(p = 0; p < 8; p++) {
    LCD12864_command(CMD_SET_PAGE | p);

    for(c = 0; c < 129; c++) {
      LCD12864_command(CMD_SET_COLUMN_LOWER | (c & 0xf));
      LCD12864_command(CMD_SET_COLUMN_UPPER | ((c >> 4) & 0xf));
      LCD12864_data(0xff);
    }     
  }
}

void clear_display(void) {
  unsigned char p, c;
  for(p = 0; p < 8; p++) {	 //8
    LCD12864_command(CMD_SET_PAGE | p);
    for(c = 0; c < 128; c++) {	   //129
      LCD12864_command(CMD_SET_COLUMN_LOWER | (c & 0xf));
      LCD12864_command(CMD_SET_COLUMN_UPPER | ((c >> 4) & 0xf));
      LCD12864_data(0x0);
    }     
  }
}

void LCD_ClearScreen_(unsigned char x) 
{
  unsigned char p, c;
  for(p = x; p < x+2; p++) {	 //8
    LCD12864_command(CMD_SET_PAGE | p);
    for(c = 0; c < 128; c++) {	   //129
      LCD12864_command(CMD_SET_COLUMN_LOWER | (c & 0xf));
      LCD12864_command(CMD_SET_COLUMN_UPPER | ((c >> 4) & 0xf));
      LCD12864_data(0x0);
    }     
  }
}

//void C_display(void) {
//  unsigned char p, c;
//  
//  for(p = 0; p < 8; p++) {
//    /*
//      putstring("new page! ");
//      uart_putw_dec(p);
//      putstring_nl("");
//    */
//    st7565_command(CMD_SET_PAGE | p);
//    for(c = 0; c < 129; c++) {
//      //uart_putw_dec(c);
//      //uart_putchar(' ');
//      st7565_command(CMD_SET_COLUMN_LOWER | (c & 0xf));
//      st7565_command(CMD_SET_COLUMN_UPPER | ((c >> 4) & 0xf));
//      st7565_data(st7565_buffer[p*128+c]);
//    }     
//  }
//}

unsigned char Lcd_WriteNumbChar(unsigned char x, unsigned char y, char *Numb)
{
  unsigned char X,Y,wordNum,j;
  char c;
  X = 128 -8*(x + 1);
  Y = y;

	while ( *Numb != '\0')	 //?C?????????‘\0’??
	{
	
		LCD12864_command(CMD_SET_PAGE | Y);
		LCD12864_command(CMD_SET_COLUMN_LOWER | (X & 0xf));
		LCD12864_command(CMD_SET_COLUMN_UPPER | ((X >> 4) & 0xf));	
				
		c = *Numb;
		if(c == ':')
			wordNum = 11;
		else if(c == '.')
			wordNum = 10;
		else
			wordNum = c - '0';



		for (j=0; j<16; j++) //????
		{		
			if (j == 8)	 //??16X8????Y??,?????8?,????
			{
				LCD12864_command(CMD_SET_PAGE | (Y + 1));
				LCD12864_command(CMD_SET_COLUMN_LOWER | (X & 0xf));
				LCD12864_command(CMD_SET_COLUMN_UPPER | ((X >> 4) & 0xf));
			}
			LCD12864_data(Numb_Char[wordNum].Msk[j]);
		}
		X -= 8;
		Numb += 1;

	}	//while??

	return 1;    
}
  
unsigned char Lcd_Write_ASCII_Char(unsigned char x, unsigned char y, unsigned char *ASCII)
{
  unsigned char X,Y,j;
  unsigned int wordNum;

  X = 128 -8*(x + 1);
  Y = 2*y;

	while ( *ASCII != '\0')	 //?C?????????‘\0’??
	{
		LCD12864_command(CMD_SET_PAGE | Y);
		LCD12864_command(CMD_SET_COLUMN_LOWER | (X & 0xf));
		LCD12864_command(CMD_SET_COLUMN_UPPER | ((X >> 4) & 0xf));	
				

		for (wordNum=0; wordNum<100; wordNum++)
		{
		   if((ASCII_Char[wordNum].Index[0] == *ASCII))
			 {
				for (j=0; j<16; j++) //????
				{		
					if (j == 8)	 //??16X8????Y??,?????8?,????
					{
						LCD12864_command(CMD_SET_PAGE | (Y + 1));
						LCD12864_command(CMD_SET_COLUMN_LOWER | (X & 0xf));
						LCD12864_command(CMD_SET_COLUMN_UPPER | ((X >> 4) & 0xf));
					}
					LCD12864_data(ASCII_Char[wordNum].Msk[j]);	
				}
				X -= 8;
			 }
		}
		 ASCII += 1;
	}	//while??

	return 1;  
}

unsigned char Lcd_Write16CnChar(unsigned char x, unsigned char y, char *cn)
{
  unsigned char X,Y,wordNum,j;
  X = 128 - 16*(x+1);
  Y = y;

	while ( *cn != '\0')	 //?C?????????‘\0’??
	{
		LCD12864_command(CMD_SET_PAGE | Y);
		LCD12864_command(CMD_SET_COLUMN_LOWER | (X & 0xf));
		LCD12864_command(CMD_SET_COLUMN_UPPER | ((X >> 4) & 0xf));	
				

		for (wordNum=0; wordNum<100; wordNum++)
		{
		   if((CN16CHAR[wordNum].Index[0] == *cn)
		     &&(CN16CHAR[wordNum].Index[1] == *(cn+1)))
			 {
				for (j=0; j<32; j++) //????
				{		
					if (j == 16)	 //??16X8????Y??,?????8?,????
					{
						LCD12864_command(CMD_SET_PAGE | (Y + 1));
						LCD12864_command(CMD_SET_COLUMN_LOWER | (X & 0xf));
						LCD12864_command(CMD_SET_COLUMN_UPPER | ((X >> 4) & 0xf));
					}
					LCD12864_data(CN16CHAR[wordNum].Msk[j]);	
				}
				X -= 16;
			 }
		}
		 cn += 2;
	}	//while??

	return 1;    
}



void GT20L16S1Y_LCD(unsigned char x, unsigned char y, char *cn)
{
    unsigned char X,Y,j,Ch[32];
	
    X = 128 - 16*(x+1);
    Y = y + 1;

	while ( *cn != '\0')
	{
//	    GetBitmap32(Ch,cn);
		LCD12864_command(CMD_SET_PAGE | Y);
		LCD12864_command(CMD_SET_COLUMN_LOWER | (X & 0xf));
		LCD12864_command(CMD_SET_COLUMN_UPPER | ((X >> 4) & 0xf));
//		for(j=0; j<32; j++)
//		{
//			SendChar(Ch[j]);
//		}

		for (j=0; j<32; j++) //????
		{		
			if (j == 16)	 //??16X8????Y??,?????8?,????
			{
				LCD12864_command(CMD_SET_PAGE | (Y - 1));
				LCD12864_command(CMD_SET_COLUMN_LOWER | (X & 0xf));
				LCD12864_command(CMD_SET_COLUMN_UPPER | ((X >> 4) & 0xf));
			}
			LCD12864_data(Ch[31-j]);	
		}

		X -= 16;
		cn += 2;
	}
}


	   
void LCD_Init(void)
{
	
	begin(0x0);
//   Display_LCD12864();
//   Full_display();
	clear_display();
//	Lcd_WriteNumbChar(1,1,"123.456");
//	Lcd_Write_ASCII_Char(3,1,"abcd");
	Lcd_Write16CnChar(0, 0,"ÍøÁªÊýÂë×¨Óªµê");
//	Lcd_Write16CnChar(0, 2,"ÍøÁªÊýÂë×¨Óªµê");
	Lcd_Write16CnChar(0, 4,"ÍøÁªÊýÂë×¨Óªµê");
//	Lcd_Write16CnChar(0, 6,"ÍøÁªÊýÂë×¨Óªµê");	
	
//	LCD_ClearScreen_(4);
//	GT20L16S1Y_LCD(0,0,"???????");
}












