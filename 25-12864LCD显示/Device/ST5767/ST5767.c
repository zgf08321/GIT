#include "ST5767.h"
#include "stm32f10x.h"
#include "delay.h"
#include "LCD12864.h"

struct Cn16CharTypeDef CN16CHAR[]=
{
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"计",0x00,0x40,0x40,0x40,0x40,0x40,0xFF,0x40,0x40,0x40,0x40,0x00,0xCC,0x42,0x40,0x40,
0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x10,0x20,0x7F,0x00,0x00,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"算",0x00,0x02,0x02,0xF2,0x56,0x52,0x53,0x54,0x50,0x52,0x52,0x56,0x52,0xF3,0x04,0x08,
0x00,0x10,0x10,0x17,0x15,0xFD,0x15,0x15,0x15,0x15,0x15,0x3D,0x55,0x97,0x10,0x10,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"器",0x00,0x80,0x9E,0x92,0xD2,0xB2,0x9E,0x80,0xE0,0x9E,0x92,0x92,0x92,0x9E,0x80,0x80,
0x00,0x08,0xF8,0x94,0x94,0x92,0xF2,0x01,0x00,0xF1,0x92,0x92,0x94,0xF4,0x08,0x08,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"温",0x00,0x00,0x00,0xFE,0x92,0x92,0x92,0x92,0x92,0xFE,0x00,0x00,0x8C,0x02,0x60,0x10,
0x00,0x40,0x7E,0x42,0x42,0x7E,0x42,0x7E,0x42,0x42,0x7E,0x40,0x01,0x7E,0x04,0x04,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"度",0x00,0x04,0x24,0x24,0x24,0xFC,0x24,0x26,0x25,0xFC,0x24,0x24,0x24,0xFC,0x00,0x00,
0x00,0x80,0x80,0x80,0x4C,0x55,0x25,0x25,0x25,0x55,0x4C,0x84,0x80,0x8F,0x30,0x40,
/*--  ??:  ?  --*/
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"时",0x00,0x10,0x10,0xFF,0x10,0x10,0x10,0x10,0x10,0x00,0xFC,0x84,0x84,0x84,0xFC,0x00,
0x00,0x00,0x00,0x7F,0x80,0x40,0x06,0x01,0x00,0x00,0x3F,0x10,0x10,0x10,0x3F,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"钟",0x00,0x00,0xF0,0x10,0x10,0xFF,0x10,0x10,0xF0,0x00,0x24,0x24,0xE7,0x2C,0x10,0x20,
0x00,0x00,0x07,0x02,0x02,0xFF,0x02,0x02,0x07,0x00,0x11,0x21,0x7F,0x01,0x01,0x01,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"保",0x00,0x00,0x00,0x3E,0x22,0x22,0xE2,0x22,0x22,0x3E,0x00,0x07,0xF8,0x60,0x80,0x00,
0x00,0x20,0x11,0x09,0x05,0x03,0xFF,0x03,0x05,0x09,0x11,0x20,0xFF,0x00,0x00,0x01,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"存",0x00,0x04,0x04,0x24,0x64,0xA4,0x24,0x24,0x24,0x24,0x07,0x1C,0xE4,0x84,0x04,0x04,
0x00,0x02,0x02,0x02,0x02,0x02,0x7F,0x82,0x42,0x02,0x02,0x00,0xFF,0x00,0x01,0x02,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"另",0x00,0x00,0x00,0x00,0x3E,0x22,0x22,0x22,0x22,0xE2,0x22,0x22,0x3E,0x00,0x00,0x00,
0x00,0x00,0x00,0x3F,0x41,0x81,0x41,0x01,0x01,0x03,0x0D,0x11,0x21,0x41,0x81,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"印",0x00,0x00,0xFC,0x04,0x04,0x04,0x04,0xFC,0x00,0x42,0x42,0x44,0x44,0x44,0xFC,0x00,
0x00,0x00,0x07,0x08,0x10,0x08,0x00,0xFF,0x00,0x08,0x08,0x08,0x10,0x10,0x1F,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"退",0x00,0x00,0x80,0x7F,0x49,0x49,0xC9,0x49,0x49,0xFF,0x00,0x00,0xCC,0x42,0x40,0x40,
0x00,0x40,0x58,0x45,0x42,0x41,0x40,0x44,0x48,0x5F,0x40,0x20,0x1F,0x20,0x40,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"出",0x00,0x00,0x00,0xFC,0x40,0x40,0x40,0x40,0xFF,0x40,0x40,0x40,0x40,0x7C,0x00,0x00,
0x00,0x00,0xFC,0x40,0x40,0x40,0x40,0x40,0x7F,0x40,0x40,0x40,0x40,0x40,0x7C,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"测",0x00,0x00,0xFF,0x00,0xF8,0x00,0xFE,0x02,0xF2,0x02,0xFE,0x00,0x8C,0x02,0x60,0x10,
0x00,0x00,0x7F,0x80,0x47,0x00,0x27,0x10,0x0F,0x30,0x47,0x80,0x01,0x7E,0x04,0x04,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"试",0x00,0x10,0x16,0x11,0x10,0xFF,0x90,0x90,0x90,0x90,0x90,0x00,0xCC,0x42,0x40,0x40,
0x00,0xF0,0x40,0x30,0x0E,0x01,0x10,0x10,0x3F,0x60,0x28,0x10,0x3F,0x00,0x00,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"菜",0x00,0x04,0x04,0x24,0xB4,0x2F,0x24,0x24,0xC4,0x44,0x44,0x4F,0xC4,0x44,0x04,0x04,
0x00,0x40,0x44,0x24,0x24,0x15,0x0C,0x04,0xFE,0x04,0x0C,0x15,0x24,0x24,0x44,0x40,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"单",0x00,0x00,0x00,0xF8,0x49,0x4A,0x4C,0x48,0xF8,0x48,0x4C,0x4A,0x49,0xF8,0x00,0x00,
0x00,0x10,0x10,0x13,0x12,0x12,0x12,0x12,0xFF,0x12,0x12,0x12,0x12,0x13,0x10,0x10,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"开",0x00,0x80,0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x80,
0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x0F,0x30,0x40,0x80,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"显",0x00,0x00,0x00,0x00,0xFE,0x92,0x92,0x92,0x92,0x92,0x92,0x92,0xFE,0x00,0x00,0x00,
0x00,0x40,0x46,0x48,0x50,0x40,0x7F,0x40,0x40,0x40,0x7F,0x40,0x58,0x44,0x42,0x40,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"示",0x00,0x40,0x40,0x42,0x42,0x42,0x42,0x42,0xC2,0x42,0x42,0x42,0x42,0x42,0x40,0x40,
0x00,0x30,0x08,0x04,0x02,0x00,0x00,0x00,0x7F,0x80,0x40,0x00,0x06,0x08,0x10,0x20,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"年",0x00,0x00,0x04,0x44,0x44,0x44,0x44,0xFC,0x44,0x44,0x44,0x44,0xC7,0x18,0x20,0x00,
0x00,0x04,0x04,0x04,0x04,0x04,0x04,0xFF,0x04,0x04,0x04,0x04,0x07,0x04,0x04,0x04,

/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"网",0x00,0x00,0xFE,0x02,0x72,0x82,0x42,0x22,0x02,0x72,0x82,0x42,0x22,0x02,0xFE,0x00,
0x00,0x00,0x7F,0x80,0x4E,0x01,0x06,0x08,0x10,0x0E,0x01,0x06,0x08,0x10,0xFF,0x00,

/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"联",0x00,0x00,0x10,0x13,0x14,0xF0,0x16,0x11,0x10,0x00,0x02,0xFE,0x92,0x92,0xFE,0x02,
0x00,0x81,0x41,0x31,0x0D,0x03,0x0D,0x31,0x41,0x81,0x04,0xFF,0x08,0x08,0x1F,0x10,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"码",0x00,0x80,0x80,0xFE,0x82,0x82,0x82,0xF2,0x02,0x00,0xC4,0x44,0x5C,0xE4,0x84,0x04,
0x00,0x3F,0x40,0x88,0x48,0x08,0x08,0x08,0x08,0x00,0x3F,0x10,0x10,0x7F,0x01,0x02,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"数",0x00,0x08,0xF8,0x08,0x08,0x8F,0x70,0x80,0x52,0x34,0x10,0xFF,0x10,0x34,0x52,0x90,
0x00,0x80,0x40,0x33,0x0C,0x33,0x40,0x80,0x00,0x8E,0x52,0x22,0x63,0x56,0x9A,0x82,



/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"专",0x00,0x40,0x40,0x48,0x48,0x48,0x48,0x48,0x4F,0x78,0xC8,0x48,0x48,0x48,0x40,0x40,
0x00,0x00,0x00,0x00,0x06,0x8A,0x52,0x22,0x22,0x12,0x12,0x03,0x00,0x00,0x00,0x00,

/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"营",0x00,0x34,0x54,0x14,0xD4,0x5F,0x54,0x54,0x54,0x54,0x54,0x5F,0xD4,0x14,0x34,0x44,
0x00,0x00,0x00,0xF8,0x4B,0x4A,0x4A,0x4A,0x4A,0x4A,0x4A,0x4A,0x4B,0xF8,0x00,0x00,

/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"店",0x00,0x04,0x44,0x44,0x44,0x44,0x44,0xFE,0x05,0x04,0x04,0x04,0x04,0xFC,0x00,0x00,
0x00,0x00,0x00,0xFE,0x42,0x42,0x42,0x43,0x42,0x42,0xFE,0x00,0x00,0x0F,0x30,0x40,
/*--  ??12;  ??????????:?x?=16x16   --*/
"普",0x00,0x40,0x44,0x54,0x64,0x45,0x7E,0x44,0x44,0x44,0x7E,0x45,0x64,0x54,0x44,0x40,
0x00,0x00,0x00,0x00,0xFF,0x49,0x49,0x49,0x49,0x49,0x49,0x49,0xFF,0x00,0x00,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"中",0x00,0x00,0xFC,0x08,0x08,0x08,0x08,0xFF,0x08,0x08,0x08,0x08,0xFC,0x08,0x00,0x00,
0x00,0x00,0x07,0x02,0x02,0x02,0x02,0xFF,0x02,0x02,0x02,0x02,0x07,0x00,0x00,0x00,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"科",0x00,0x00,0x00,0xFF,0x00,0x00,0xCC,0x22,0x00,0x91,0x51,0xFE,0x72,0x92,0x12,0x10,
0x00,0x01,0x01,0xFF,0x02,0x02,0x02,0x04,0x04,0x04,0x00,0xFF,0x00,0x01,0x02,0x04,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"技",0x00,0x08,0x48,0xC8,0x48,0x7F,0x48,0x48,0xC8,0x00,0x28,0x48,0xFF,0x88,0x08,0x08,
0x00,0x20,0x60,0x21,0x12,0x0C,0x0C,0x13,0x20,0x40,0x40,0x00,0x7F,0x80,0x41,0x01,
/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"有",0x00,0x04,0x04,0x04,0xE4,0x24,0x24,0x24,0x27,0x2C,0x34,0xE4,0x44,0x84,0x04,0x00,
0x00,0x00,0x00,0x00,0x7F,0xC9,0x49,0x29,0x09,0x09,0x09,0xFF,0x00,0x00,0x01,0x02,

/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"限",0x00,0x00,0x00,0x7E,0x4A,0x4A,0x4A,0xCA,0x4A,0xFE,0x00,0x82,0x4E,0x32,0x02,0xFE,
0x00,0x20,0x60,0x21,0x12,0x0C,0x03,0x20,0x40,0xFF,0x00,0x03,0x04,0x02,0x00,0xFF,

/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"公",0x00,0x80,0x80,0xC0,0x60,0x10,0x0E,0x00,0x00,0x84,0x0E,0x30,0x40,0x80,0x00,0x00,
0x00,0x00,0x01,0x30,0x78,0x14,0x10,0x10,0x31,0x23,0x24,0x28,0x70,0x20,0x01,0x00,

/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"司",0x00,0x00,0xFE,0x02,0x02,0x12,0x92,0x92,0x92,0x92,0x92,0x92,0x92,0x92,0x10,0x00,
0x00,0x00,0x3F,0x40,0x20,0x00,0x0F,0x04,0x04,0x04,0x04,0x04,0x04,0x1F,0x00,0x00,

/*--  ??:  ?  --*/
/*--  ??12;  ??????????:?x?=16x16   --*/
"打",0x00,0x04,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0x04,0x90,0x10,0xFF,0x10,0x10,0x10,
0x00,0x00,0x00,0x00,0x00,0x7F,0x80,0x40,0x00,0x00,0x00,0x01,0x7F,0x82,0x44,0x04,
};

void InitST7567_IO(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8|GPIO_Pin_11;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;
	
	/*打开LED使用的GPIO的时钟使能*/
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);
	GPIO_Init(GPIOA, &GPIO_InitStructure);	 //初始化
	
	/*打开LED使用的GPIO的时钟使能*/
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_2|DATA_PORT; //|DATA_PORT
	GPIO_Init(GPIOB, &GPIO_InitStructure);	 //初始化
}

//void InitST7567_IO(void)
//{
//	GPIO_InitTypeDef  GPIO_InitStructure;

//	RCC_APB2PeriphClockCmd(RCC_ST5767, ENABLE);	 
//	//使能PA,PB端口时钟
//	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8|GPIO_Pin_11;	
//	//CS-->PA.8 端口配置  RSET-->PA.11
//	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 		  
//	//推挽输出
//	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;		  
//	//IO口速度为50MHz
//	GPIO_Init(GPIOA, &GPIO_InitStructure);					      
//	//根据设定参数初始化GPIOA.8\GPIOA.11
//	GPIO_SetBits(GPIOA,GPIO_Pin_8|GPIO_Pin_11);						           
//	//PA.8/PA.11 输出高

//	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_2;	    		 
//	//RW-->PB.0 RS-->PB.1 RD-->PB.2 端口配置, 推挽输出
//	GPIO_Init(GPIOB, &GPIO_InitStructure);	  				   
//	//推挽输出 ，IO口速度为50MHz
//	GPIO_SetBits(GPIOB,GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_2); 						         
//	//PB.0  PB.1  PB.2 输出高 
//	
//	GPIO_InitStructure.GPIO_Pin = DATA_PORT;	    		 
//	//DATA_PORT-->PB.8~PB.15端口配置, 推挽输出
//	GPIO_Init(GPIOB, &GPIO_InitStructure);	  				   
//	//推挽输出 ，IO口速度为50MHz
//	GPIO_SetBits(GPIOB,DATA_PORT); 						         
//	//DATA_PORT-->PB.8~PB.15 输出高 	
//}

void Delay_ms(unsigned int c)
{
	unsigned int a,b;
	for(; c>0; c--)
		for(a=1000; a>0; a--)
			for(b=1000; b>0; b--);
}

void Sets_DATA_PORT(unsigned char data)
{
	uint16_t setValue;

	setValue = GPIO_ReadOutputData(GPIO_PORT);
	setValue &= 0x00ff;//我们使用的是16位中的高8位					
	setValue |= (uint16_t)data << 8;
	GPIO_Write(GPIO_PORT,setValue);
}



void LcdSt7565_WriteCmd(unsigned char cmd)
{
	CS(0);	   //chip select,????
	RD(1);	   //disable read,???	
	RS(0);       //select command,????
	RW(0);       //select write,?????
	delay_ms(5);
	Sets_DATA_PORT(cmd); //put command,????
	delay_ms(5);
	RW(1);	   //command writing ,????
}

void LcdSt7565_WriteData(unsigned char dat)
{	
	CS(0);	   //chip select,????
	RD(1);	   //disable read,???	
	RS(1);       //select data,????
	RW(0);       //select write,?????
	delay_ms(5);
	Sets_DATA_PORT(dat);       //put data,????
	delay_ms(5);
	RW(1);	   //data writing,??? 
}


void Lcd12864_Init()
{
//	unsigned char i;
	RSET(0);
//	for (i=0; i<100; i++)
	delay_ms(500);
	CS(0);
	RSET(1);
	
	LcdSt7565_WriteCmd(0xE2);  //reset
//	for (i=0; i<100; i++)	   //????
	delay_ms(10);
	
	LcdSt7565_WriteCmd(0xA1);  //ADC select segment direction 
	
	LcdSt7565_WriteCmd(0xC8);  //Common direction 

	LcdSt7565_WriteCmd(0xA6);  //reverse display

	LcdSt7565_WriteCmd(0xA4);  //normal display
	
	LcdSt7565_WriteCmd(0xA2);  //bias set 1/9
	
	LcdSt7565_WriteCmd(0xF8);  //Boost ratio set
	LcdSt7565_WriteCmd(0x01);  //x4
	
	LcdSt7565_WriteCmd(0x81);  //V0 a set
	LcdSt7565_WriteCmd(0x23);

	LcdSt7565_WriteCmd(0x25);  //Ra/Rb set
	
	LcdSt7565_WriteCmd(0x2F);
//	for (i=0; i<100; i++)
	delay_ms(50);
	
	LcdSt7565_WriteCmd(0x40);  //start line

	LcdSt7565_WriteCmd(0xAF);  // display on
//	for (i=0; i<1; i++)
	delay_ms(50);
}

void Lcd12864_ClearScreen(void)
{
	unsigned char i, j;

	for(i=0; i<8; i++)
	{
		LcdSt7565_WriteCmd(0xB0+i); 

		LcdSt7565_WriteCmd(0x10); 
		LcdSt7565_WriteCmd(0x04);							   
		
		for(j=0; j<128; j++)
		{
			LcdSt7565_WriteData(0x00);  
		}
	}
}

void LCD12864_ClearScreen_(unsigned char x)
{
	unsigned char i, j;

	for(i=x; i<x+2; i++)
	{
		LcdSt7565_WriteCmd(0xB0+i); 

		LcdSt7565_WriteCmd(0x10); 
		LcdSt7565_WriteCmd(0x04);							   
		
		for(j=0; j<128; j++)
		{
			LcdSt7565_WriteData(0x00);  
		}
	}
}

unsigned char Lcd12864_Write16CnCHAR(unsigned char x, unsigned char y, char *cn)
{
	unsigned char j, x1, x2;
	unsigned int wordNum;
	x =128 - 16*(x+1);
	if(y > 7)  {
		return 0;
	}
	
	if(x > 128){
		return 0;
	}

	y += 0xB0;	   
	
	LcdSt7565_WriteCmd(y);
	while ( *cn != '\0')	 
	{	
		//--??Y??--//
		LcdSt7565_WriteCmd(y);

		x1 = (x >> 4) & 0x0F;  
		x2 = x & 0x0F;         
		//--??X??--//
		LcdSt7565_WriteCmd(0x10 + x1);   
		LcdSt7565_WriteCmd(0x04 + x2);	

		for (wordNum=0; wordNum<100; wordNum++)
		{
			
		  if ((CN16CHAR[wordNum].Index[0] == *cn)
		  		&&(CN16CHAR[wordNum].Index[1] == *(cn+1)))
			{
				for (j=0; j<32; j++) //????
				{		
					if (j == 16)	 
					{
						//--??Y??--//
			   			LcdSt7565_WriteCmd(y + 1);
			
						//--??X??--//
						LcdSt7565_WriteCmd(0x10 + x1);   //?4?
						LcdSt7565_WriteCmd(0x04 + x2);	//?4?
					}
					LcdSt7565_WriteData(CN16CHAR[wordNum].Msk[j]);
				}
				x -= 16;
			}//if?????		
		} //for????	
		cn += 2;
	}	//while??

	return 1;
}


